# 扫雷概率计算

任何时刻，整个游戏区域都可以分为三部分：已经确定的区域、未确定但是周围八格有数字的区域 B、完全没有信息的区域 A。如果没有足够信息，有的时候需要在区域 A 点开一个角（或者伪角）。我可以证明下面这个定理：

> 如果区域 B 只有两种排布，其中一种比另一种少一个雷，那么直接猜少一个雷的那种可能就好了，存活概率是与在区域 A 随手点一个的存活概率完全相等的。

## 证明

假设区域 B 只有两种排布，一种有 $b$ 个雷，一种有 $b+1$ 个；A+B 区域剩余雷的数量为 $a+b$ 个；A 区域总共有 $A$ 格。那么区域 B 有 $b$ 个雷的可能情况数为：
$$
\text{C}_A^a=\frac{A!}{a!(A-a)!}
$$
即在区域 A 中选 $a$ 个格子当雷的组合数。

而如果我们要点一个伪角，比如某个 $(x,y)$ 吧；它不是雷的可能情况数为：
$$
\text{C}_{A-1}^{a-1}+\text{C}_{A-1}^a=\frac{(A-1)!}{(a-1)!(A-a)!}+\frac{(A-1)!}{a!(A-a-1)!}
$$
前一项是指，如果 B 区域是 $b+1$ 个雷的排布，那么 $(x,y)$ 不是雷的可能情况数，就是在 A 区域中除了 $(x,y)$ 之外的 $A-1$ 个格子里选 $a-1$ 个格子做雷；后一项是指，如果 B 区域是 $b$ 个雷的排布，那么 $(x,y)$ 不是雷的可能情况数，就是在 A 区域中除了 $(x,y)$ 之外的 $A-1$ 个格子里选 $a$ 个格子当雷。

而显然我们有 $\text{C}_{A-1}^{a-1}+\text{C}_{A-1}^a=\text{C}_A^a$。或者也可以通过上面两个公式暴力硬算：
$$
\begin{aligned}
\text{C}_{A-1}^{a-1}+\text{C}_{A-1}^a=&\frac{(A-1)!}{a!(A-a)!}\cdot a+\frac{(A-1)!}{a!(A-a)!}\cdot(A-a)\\
=&\frac{(A-1)!}{a!(A-a)!}(a+A-a)\\
=&\frac{(A-1)!\cdot A}{a!(A-a)!}=\text{C}_A^a
\end{aligned}
$$
这样我们就证明完了。▢

所以，如果根据现有条件不能判断，需要点角（或者伪角）的时候，其实也可以根据有信息的区域的排布情况来判断。如果 B 区域只有两种情况、而且一种比另一种少一雷，那么直接猜少一雷的那一种，存活概率和点伪角是精准相等的。

但是区域 B 只有两种排布的局面毕竟不多。对于更一般的局面，比如区域 B 不止两种排布的情况，也可以用同样的方法来计算不同排布之间的概率之比。

## 不同雷数排布的概率比

假设区域 B 有不少排布，其中一种排布有 $b$ 个雷，另一种有 $b+n$ 个雷。那么两者出现的概率比（其实也就是可能的局面数之比）为
$$
\frac{\text{C}_A^a}{\text{C}_A^{a-n}}=\frac{A!/(a!(A-a)!)}{A!/((a-n)!(A-a+n)!)}=\frac{(a-n)!}{a!}\frac{(A-a+n)!}{(A-a)!}
$$
如果 $n=1$，那么上面这个比就是 $\displaystyle \frac{A+1}{a}-1$；如果 $n=2$，上面就是 $\displaystyle \left(\frac{A+1}{a}-1\right)\left(\frac{A+1}{a-1}-1\right)$……总之概率之比会越来越大。

一个有用的事实是，高级图中雷密度是 $99/(30\cdot16)$，那么我们可以用雷密度来估算一下，$(A+1)/a\approx30\cdot16/99$；如果 $n=1$，那么两种排布的概率比约为 $30\cdot16/99-1\approx3.85$。如果差两个雷，那么概率比大概是上面这个值的平方。
